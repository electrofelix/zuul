pipelines:
  - name: check
    description: Standard check
    manager: IndependentPipelineManager
    source: github
    trigger:
      github:
        - event:
            - pr-open
            - pr-change
            - pr-reopen
          branch: '^master$'
        - event: pr-comment
          comment: 'test me'
    start:
      github:
        status: true
    success:
      github:
        status: true
        comment: true
    failure:
      github:
        status: true
        comment: true

  - name: context-check
    description: Check with custom context
    manager: IndependentPipelineManager
    source: github
    trigger:
      github:
        - event:
            - pr-open
            - pr-change
            - pr-reopen
          branch: '^master$'
        - event: pr-comment
          comment: 'test me'
    start:
      github:
        status: true
        context: continuous-integration/zuul/check
    success:
      github:
        status: true
        context: continuous-integration/zuul/check
        comment: true
    failure:
      github:
        status: true
        context: continuous-integration/zuul/check
        comment: true

  - name: gate
    description: Gatekeeping
    manager: DependentPipelineManager
    source: github
    trigger:
      github:
        - event: pr-label
          label: 'merge'
    start:
      github:
        status: true
    success:
      github:
        status: true
        merge: true
        label: '-merge'
    failure:
      github:
        status: true
        comment: true
        label: '-merge'


  - name: reporting
    description: Uncommon reporting
    manager: IndependentPipelineManager
    source: github
    trigger:
      github:
        - event: pr-comment
          comment: 'reporting check'
    start:
      github:
        comment: true
    success:
      github:
        comment: false
        status: true
        status_url: http://logs.example.com/{change.project.name}/{change.number}/{change.patchset}
    failure:
      github:
        comment: false
        status: true
        status_url: http://logs.example.com/{change.project.name}/{change.number}/{change.patchset}


  - name: merge
    description: Pipeline for merging the pull request
    manager: IndependentPipelineManager
    source: github
    merge-failure-message: 'Merge failed'
    trigger:
      github:
        - event: pr-comment
          comment: 'merge me'
    success:
      github:
        merge: true

  - name: labels
    description: Trigger on labels
    manager: IndependentPipelineManager
    source: github
    trigger:
      github:
        - event: pr-label
          label:
            - 'test'
            - '-do not test'

    success:
      github:
        label:
          - 'tests passed'
          - '-test'

  - name: post
    manager: IndependentPipelineManager
    source: github
    trigger:
      github:
        - event: push
          ref: '^refs/heads/master$'

  - name: tag
    manager: IndependentPipelineManager
    source: github
    trigger:
      github:
        - event: tag

  - name: reviews
    description: Trigger on review
    manager: IndependentPipelineManager
    source: github
    trigger:
      github:
        - event: pr-review
          state: 'approve'

    success:
      github:
        label:
          - 'tests passed'
          - '-test'

jobs:
  - name: ^.*-merge$
    failure-message: Unable to merge change
    hold-following-changes: true
  - name: project-testfile
    files:
      - '.*-requires'

projects:
  - name: org/project
    check:
      - project-merge:
        - project-test1
        - project-test2
    gate:
      - project-merge:
        - project-test1
        - project-test2
    merge:
      - noop
    post:
      - project-post
    tag:
      - project-tag
    reporting:
      - project-test1
    labels:
      - project-labels
    reviews:
      - project-reviews

  - name: org/one-job-project
    check:
      - one-job-project-merge

  - name: org/project1
    check:
      - project-testfile

  - name: org/project2
    context-check:
      - project-testcontext
